<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandbox Elemental - Laboratorio de Part√≠culas</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=JetBrains+Mono:wght@400;600&display=swap');
        * { margin:0; padding:0; box-sizing:border-box; }
        :root {
            --bg-dark:#0a0e15; --bg-panel:#131920;
            --accent-cyan:#00fff2; --accent-magenta:#ff00aa;
            --accent-yellow:#ffeb3b; --text-primary:#e0e7ff;
            --text-secondary:#7a8aaa; --border-glow:rgba(0,255,242,0.3);
        }
        body { font-family:'JetBrains Mono',monospace; background:linear-gradient(135deg,var(--bg-dark) 0%,#1a1430 100%); color:var(--text-primary); overflow:hidden; height:100vh; display:flex; flex-direction:column; }
        body::before { content:''; position:fixed; top:0; left:0; width:100%; height:100%; background-image:linear-gradient(rgba(0,255,242,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,242,0.03) 1px,transparent 1px); background-size:50px 50px; pointer-events:none; animation:gridMove 20s linear infinite; }
        @keyframes gridMove { 0%{transform:translate(0,0)} 100%{transform:translate(50px,50px)} }
        header { background:var(--bg-panel); padding:0.8rem 2rem; border-bottom:2px solid var(--accent-cyan); box-shadow:0 4px 20px rgba(0,255,242,0.2); position:relative; z-index:10; }
        h1 { font-family:'Orbitron',sans-serif; font-size:1.5rem; font-weight:900; background:linear-gradient(135deg,var(--accent-cyan),var(--accent-magenta)); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; text-transform:uppercase; letter-spacing:3px; animation:titlePulse 3s ease-in-out infinite; }
        @keyframes titlePulse { 0%,100%{filter:brightness(1)} 50%{filter:brightness(1.3)} }
        .container { display:flex; flex:1; gap:1rem; padding:1rem; position:relative; z-index:1; overflow:hidden; }
        .sidebar { background:var(--bg-panel); border:2px solid var(--accent-cyan); border-radius:12px; padding:0.8rem; width:268px; flex-shrink:0; box-shadow:0 8px 32px rgba(0,255,242,0.15); overflow-y:auto; max-height:calc(100vh - 100px); display:flex; flex-direction:column; gap:0.5rem; }
        .sidebar::-webkit-scrollbar{width:5px} .sidebar::-webkit-scrollbar-track{background:var(--bg-dark);border-radius:4px} .sidebar::-webkit-scrollbar-thumb{background:var(--accent-cyan);border-radius:4px}
        .mat-section-title { grid-column:1/-1; font-family:'Orbitron',sans-serif; font-size:0.55rem; font-weight:700; color:var(--accent-cyan); text-transform:uppercase; letter-spacing:2px; padding:5px 2px 3px; border-bottom:1px solid rgba(0,255,242,0.25); margin-top:3px; }
        .eraser-btn { background:linear-gradient(135deg,#1a0f0a,#2a1510); border:2px solid #ff6b35; border-radius:8px; padding:0.45rem 0.6rem; cursor:pointer; transition:all 0.3s ease; font-family:'JetBrains Mono',monospace; font-weight:600; font-size:0.65rem; text-transform:uppercase; letter-spacing:0.5px; color:#ff6b35; width:100%; display:flex; align-items:center; justify-content:center; gap:0.4rem; }
        .eraser-btn:hover{box-shadow:0 4px 15px rgba(255,107,53,0.4);transform:translateY(-1px)}
        .eraser-btn.active{box-shadow:0 0 20px rgba(255,107,53,0.5),inset 0 0 20px rgba(255,107,53,0.1);animation:eraserPulse 2s ease-in-out infinite;color:#fff}
        .material-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:0.3rem; }
        .material-btn { background:linear-gradient(135deg,var(--bg-dark),#1a1f2e); border:1.5px solid rgba(255,255,255,0.08); border-radius:6px; padding:0.3rem 0.15rem; cursor:pointer; transition:all 0.25s ease; font-family:'JetBrains Mono',monospace; font-weight:600; font-size:0.55rem; text-transform:uppercase; letter-spacing:0.3px; color:var(--text-primary); text-align:center; }
        .material-btn:hover{transform:translateY(-1px);border-color:rgba(0,255,242,0.4);box-shadow:0 3px 10px rgba(0,255,242,0.2)}
        .material-btn.active{border-color:var(--accent-cyan);box-shadow:0 0 12px var(--border-glow),inset 0 0 12px rgba(0,255,242,0.08);animation:activePulse 2s ease-in-out infinite}
        .material-color{width:18px;height:18px;border-radius:4px;margin:0 auto 0.2rem;border:1.5px solid rgba(255,255,255,0.15);box-shadow:0 1px 4px rgba(0,0,0,0.4)}
        .controls{background:rgba(19,25,32,0.8);border:1px solid var(--accent-cyan);border-radius:8px;padding:0.7rem}
        .control-label{font-size:0.62rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:1px;margin-bottom:0.4rem;display:block}
        .btn-control{background:linear-gradient(135deg,var(--bg-dark),#1a1f2e);border:2px solid var(--accent-magenta);color:var(--text-primary);padding:0.45rem 1rem;border-radius:6px;cursor:pointer;font-family:'JetBrains Mono',monospace;font-weight:600;font-size:0.72rem;text-transform:uppercase;width:100%;margin-top:0.4rem;transition:all 0.3s ease;letter-spacing:1px}
        .canvas-container{flex:1;display:flex;justify-content:center;align-items:center}
        canvas{border:3px solid var(--accent-cyan);border-radius:12px;box-shadow:0 0 40px rgba(0,255,242,0.4),0 0 80px rgba(255,0,170,0.2);cursor:crosshair;background:#000}
        .info-text{font-size:0.6rem;color:var(--text-secondary);margin-top:0.5rem;line-height:1.5}
        .section-title{font-family:'Orbitron',sans-serif;font-size:0.72rem;font-weight:700;color:var(--accent-cyan);text-transform:uppercase;letter-spacing:2px;margin-bottom:0.5rem;padding-bottom:0.4rem;border-bottom:1px solid rgba(0,255,242,0.3)}
    </style>
</head>
<body>
<header><h1>‚öõ Sandbox Elemental ‚öõ</h1></header>
<div class="container">
    <aside class="sidebar">
        <div class="section-title">Materiales</div>
        <button class="eraser-btn" id="eraserBtn">üßπ Borrar (Goma)</button>
        <div class="material-grid" id="materialGrid"></div>
        <div class="controls">
            <div class="section-title">Controles</div>
            <label class="control-label">Tama√±o del Pincel</label>
            <div class="slider-container">
                <input type="range" id="brushSize" min="1" max="20" value="5">
                <div class="info-text">Tama√±o: <span id="brushValue">5</span>px</div>
            </div>
            <button class="btn-control" id="clearBtn">üóëÔ∏è Limpiar Todo</button>
            <button class="btn-control" id="pauseBtn">‚è∏Ô∏è Pausar</button>
            <div class="info-text" style="margin-top:0.8rem">
                üåø La planta necesita agua para crecer o se secar√°.<br>
                üöú Cosechadora: Limpia todo a su paso rebotando.<br>
                üí° Bombilla: se ilumina con corriente.
            </div>
        </div>
    </aside>
    <div class="canvas-container">
        <canvas id="canvas" width="800" height="600"></canvas>
    </div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const pixelSize = 2;
const width = 400;
const height = 300;

let grid = Array(height).fill(null).map(() => Array(width).fill(null));
let selectedMaterial = 'sand';
let isErasing = false;
let brushSize = 5;
let isDrawing = false;
let isPaused = false;

const MATERIAL_ORDER = [
    '__B√°sicos',
    'sand','water','stone','dirt','clay','glass','salt','concrete_powder','concrete','brick',
    '__El√©ctricos & Especiales',
    'condenser','firestone','harvester',
    'rubber','bulb','door',
    'electricity','metal','copper','silver','gold',
    'obsidian','portal',
    '__Fuego & Calor',
    'fire','lava','magma','plasma',
    'wood','coal','oil','petroleum',
    '__Gases',
    'steam','smoke','oxygen','hydrogen','methane',
    '__Biolog√≠a',
    'plant','seed','ice',
    '__Qu√≠mica',
    'acid',
];

const MATERIALS = {
    sand:            { name:'Arena',       color:'#f4a460', density:1.5,  type:'powder' },
    water:           { name:'Agua',        color:'#1e90ff', density:1,    type:'liquid' },
    stone:           { name:'Piedra',      color:'#696969', density:10,   type:'solid'  },
    dirt:            { name:'Tierra',      color:'#5c4033', density:1.6,  type:'powder' },
    clay:            { name:'Arcilla',     color:'#b8860b', density:1.7,  type:'powder' },
    glass:           { name:'Vidrio',      color:'#c8e8ff', density:2.5,  type:'solid'  },
    salt:            { name:'Sal',         color:'#f0f0f0', density:2.1,  type:'powder' },
    concrete_powder: { name:'P.Hormig√≥n',  color:'#a9a9a9', density:1.8,  type:'powder' },
    concrete:        { name:'Hormig√≥n',    color:'#888888', density:2.4,  type:'solid'  },
    brick:           { name:'Ladrillo',    color:'#b22222', density:2.0,  type:'solid'  },
    condenser: { name:'Condensador', color:'#4488aa', density:3, type:'solid' },
    firestone:  { name:'PiedraFuego',color:'#cc3300', density:3, type:'solid'  },
    harvester:  { name:'Cosechadora',color:'#ffffff', density:0, type:'special' },
    rubber:     { name:'Goma',       color:'#333333', density:1.2,type:'solid' },
    bulb:       { name:'Bombilla',   color:'#998855', density:1,  type:'solid' },
    door:       { name:'Puerta',     color:'#7a4010', density:3,  type:'solid' },
    electricity: { name:'Electr.',   color:'#ffff00', density:0,  type:'energy', life:15 },
    metal:       { name:'Metal',     color:'#b8b8b8', density:7,  type:'solid', conductive:true },
    copper:      { name:'Cobre',     color:'#b87333', density:8.96,type:'solid',conductive:true },
    silver:      { name:'Plata',     color:'#c8c8c8', density:10.5,type:'solid',conductive:true },
    gold:        { name:'Oro',       color:'#ffd700', density:19.3,type:'solid',conductive:true },
    obsidian:    { name:'Obsidiana', color:'#0f0820', density:2.6, type:'solid' },
    portal:      { name:'Portal',    color:'#8b00ff', density:0,   type:'special' },
    fire:      { name:'Fuego',    color:'#ff4500', density:0.1,  type:'gas',    life:60  },
    lava:      { name:'Lava',     color:'#ff4500', density:2,    type:'liquid', hot:true },
    magma:     { name:'Magma',    color:'#ff6600', density:3,    type:'liquid', hot:true },
    plasma:    { name:'Plasma',   color:'#ff00ff', density:0.08, type:'gas',    life:80, hot:true },
    wood:      { name:'Madera',   color:'#8b4513', density:0.6,  type:'solid',  flammable:true },
    coal:      { name:'Carb√≥n',   color:'#1c1c1c', density:1.4,  type:'solid',  flammable:true },
    oil:       { name:'Aceite',   color:'#654321', density:0.8,  type:'liquid', flammable:true },
    petroleum: { name:'Petr√≥leo', color:'#1a1a1a', density:0.85, type:'liquid', flammable:true },
    steam:    { name:'Vapor',     color:'#d8d8d8', density:0.05,    type:'gas', life:120 },
    smoke:    { name:'Humo',      color:'#505050', density:0.03,    type:'gas', life:150 },
    oxygen:   { name:'Ox√≠geno',   color:'#d6f0ff', density:0.0014,  type:'gas', life:250 },
    hydrogen: { name:'Hidr√≥geno', color:'#ffe6e6', density:0.00009, type:'gas', life:200 },
    methane:  { name:'Metano',    color:'#90ee90', density:0.02,    type:'gas', life:200 },
    plant: { name:'Planta',  color:'#32cd32', density:0.8, type:'solid'  },
    seed:  { name:'Semilla', color:'#a0522d', density:1.2, type:'powder' },
    ice:   { name:'Hielo',   color:'#87ceeb', density:0.9, type:'solid'  },
    acid: { name:'√Åcido', color:'#adff2f', density:1.2, type:'liquid' },
};

function initUI() {
    const materialGrid = document.getElementById('materialGrid');
    MATERIAL_ORDER.forEach(key => {
        if (key.startsWith('__')) {
            const t = document.createElement('div');
            t.className = 'mat-section-title';
            t.textContent = key.slice(2);
            materialGrid.appendChild(t);
            return;
        }
        const mat = MATERIALS[key]; if (!mat) return;
        const btn = document.createElement('button');
        btn.className = 'material-btn';
        btn.dataset.key = key;
        btn.innerHTML = `<div class="material-color" style="background:${mat.color}"></div><div>${mat.name}</div>`;
        btn.onclick = () => selectMaterial(key);
        materialGrid.appendChild(btn);
    });
    document.getElementById('brushSize').oninput = e => {
        brushSize = parseInt(e.target.value);
        document.getElementById('brushValue').textContent = brushSize;
    };
    document.getElementById('clearBtn').onclick = () => { grid = Array(height).fill(null).map(() => Array(width).fill(null)); };
    document.getElementById('pauseBtn').onclick = function () { isPaused = !isPaused; this.textContent = isPaused ? '‚ñ∂Ô∏è Reanudar' : '‚è∏Ô∏è Pausar'; };
    document.getElementById('eraserBtn').onclick = () => {
        isErasing = !isErasing;
        document.getElementById('eraserBtn').classList.toggle('active', isErasing);
        canvas.style.cursor = isErasing ? 'cell' : 'crosshair';
    };
}

function selectMaterial(key) {
    selectedMaterial = key; isErasing = false;
    document.getElementById('eraserBtn').classList.remove('active');
    document.querySelectorAll('.material-btn').forEach(b => b.classList.toggle('active', b.dataset.key === key));
}

function movePowder(x, y) {
    const p = grid[y][x];
    if (y+1 < height && !grid[y+1][x]) { grid[y+1][x]=p; grid[y][x]=null; return; }
    const d = Math.random()<0.5?-1:1;
    if (y<height-1 && x+d>=0 && x+d<width && !grid[y+1][x+d]) { grid[y+1][x+d]=p; grid[y][x]=null; }
}

function moveLiquid(x, y) {
    const p=grid[y][x];
    if(y+1<height && !grid[y+1][x]){grid[y+1][x]=p;grid[y][x]=null;return;}
    const d=Math.random()<0.5?-1:1;
    if(x+d>=0 && x+d<width && !grid[y][x+d]){grid[y][x+d]=p;grid[y][x]=null;}
}

function updateParticle(x, y) {
    const p = grid[y][x]; if (!p) return;
    const mat = MATERIALS[p.type];

    if (p.type === 'harvester') {
        if (p.vx === undefined) p.vx = 1;
        let nx = x + p.vx;
        if (nx < 0 || nx >= width) { p.vx *= -1; nx = x + p.vx; }
        if (grid[y][nx] && grid[y][nx].type !== 'harvester') grid[y][nx] = null;
        grid[y][nx] = p; grid[y][x] = null;
        return;
    }

    if (p.life !== undefined) { p.life--; if (p.life<=0) { grid[y][x] = null; return; } }
    if (mat.type==='powder') movePowder(x, y);
    if (mat.type==='liquid') moveLiquid(x, y);
    if (mat.type==='gas') { if(y>0 && Math.random()<0.1) { const nx=x+Math.floor(Math.random()*3)-1; if(nx>=0 && nx<width && !grid[y-1][nx]){grid[y-1][nx]=p; grid[y][x]=null;}}}

    // L√≥gica de Planta
    if (p.type === 'plant') {
        if (p.waterLevel === undefined) p.waterLevel = 100;
        if (p.dryLevel === undefined) p.dryLevel = 0;
        
        p.waterLevel -= 0.1; 

        // Buscar agua cerca
        let foundWater = false;
        for(let dy=-1;dy<=1;dy++) for(let dx=-1;dx<=1;dx++) {
            let nx=x+dx, ny=y+dy;
            if(nx>=0 && nx<width && ny>=0 && ny<height && grid[ny][nx] && grid[ny][nx].type === 'water') {
                grid[ny][nx] = null; 
                p.waterLevel = 100;
                p.dryLevel = 0;
                p.color = '#32cd32'; 
                foundWater = true;
            }
        }

        if (p.waterLevel > 50 && Math.random() < 0.01) {
            const dirs = [[0,-1],[-1,0],[1,0]];
            const d = dirs[Math.floor(Math.random()*3)];
            const nx=x+d[0], ny=y+d[1];
            if(nx>=0 && nx<width && ny>=0 && ny<height && !grid[ny][nx]) grid[ny][nx]={type:'plant', waterLevel: p.waterLevel-10};
        }

        if (p.waterLevel <= 0) {
            p.dryLevel++;
            if (p.dryLevel > 200) { p.color = '#bcaf80'; } // Color marr√≥n claro (seco)
            if (p.dryLevel > 600) grid[y][x] = null; // Muere definitivamente
        }
    }

    if (p.type === 'seed' && y < height-1 && grid[y+1][x] && grid[y+1][x].type === 'water') {
        grid[y][x] = {type:'plant', waterLevel: 100};
    }
}

canvas.addEventListener('mousedown', e=>{isDrawing=true;applyTool(e);});
canvas.addEventListener('mousemove', e=>{if(isDrawing)applyTool(e);});
window.addEventListener('mouseup', ()=>{isDrawing=false;});

function applyTool(e){
    const rect=canvas.getBoundingClientRect();
    const x=Math.floor((e.clientX-rect.left)/pixelSize);
    const y=Math.floor((e.clientY-rect.top)/pixelSize);
    for(let dy=-brushSize;dy<=brushSize;dy++) for(let dx=-brushSize;dx<=brushSize;dx++){
        if(Math.sqrt(dx*dx+dy*dy)<=brushSize){
            const px=x+dx,py=y+dy;
            if(px>=0&&px<width&&py>=0&&py<height){
                if(isErasing) grid[py][px]=null;
                else if(!grid[py][px]) grid[py][px]={type:selectedMaterial};
            }
        }
    }
}

function render(){
    ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<height;y++) for(let x=0;x<width;x++){
        const p=grid[y][x]; if(!p) continue;
        ctx.fillStyle = p.color || MATERIALS[p.type].color;
        ctx.fillRect(x*pixelSize,y*pixelSize,pixelSize,pixelSize);
    }
}

function update(){
    if(!isPaused){
        for(let y=height-1;y>=0;y--) for(let x=0;x<width;x++) updateParticle(x,y);
    }
    render();
    requestAnimationFrame(update);
}

initUI();
update();
</script>
</body>
</html>
